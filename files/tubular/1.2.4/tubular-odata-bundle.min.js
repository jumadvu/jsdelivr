(function(n){"use strict";n.module("tubular.services").factory("tubularOData",["tubularHttp",function(n){function r(t,i){return n.get(t+"("+i+")")}function u(n){var t=n.data,r=n.serverUrl,f,u,e;return r+=r.indexOf("?")>0?"&":"?",r+="$format=json&$inlinecount=allpages",r+="&$select="+t.Columns.map(function(n){return n.Name}).join(","),t.Take!==-1&&(r+="&$skip="+t.Skip,r+="&$top="+t.Take),f=t.Columns.filter(function(n){return n.SortOrder>0}).sort(function(n,t){return n.SortOrder-t.SortOrder}).map(function(n){return n.Name+" "+(n.SortDirection==="Descending"?"desc":"")}),f.length>0&&(r+="&$orderby="+f.join(",")),u=t.Columns.filter(function(n){return n.Filter&&n.Filter.Text}).map(function(n){return i[n.Filter.Operator].replace("{0}",n.Name).replace("{1}",n.DataType==="string"?'"'+n.Filter.Text+'"':n.Filter.Text)}).filter(function(n){return n.length>1}),t.Search&&t.Search.Operator==="Auto"&&(e=t.Columns.filter(function(n){return n.Searchable}).map(function(n){return'startswith({0}, "{1}") eq true'.replace("{0}",n.Name).replace("{1}",t.Search.Text)}),e.length>0&&u.push("("+e.join(" or ")+")")),u.length>0&&(r+="&$filter="+u.join(" and ")),r}function t(i){var r=i.data,o=i.serverUrl,f,e;return i.serverUrl=u(i),i.data=null,f=n.retrieveDataAsync(i),e=f.promise.then(function(n){var u={Payload:n.value,CurrentPage:1,TotalPages:1,TotalRecordCount:1,FilteredRecordCount:1};return u.TotalRecordCount=parseInt(n["odata.count"]),u.FilteredRecordCount=u.TotalRecordCount,u.TotalPages=parseInt((u.FilteredRecordCount+r.Take-1)/r.Take),u.CurrentPage=parseInt(1+r.Skip/u.FilteredRecordCount*u.TotalPages),u.CurrentPage>u.TotalPages&&(u.CurrentPage=1,i.data=r,i.data.Skip=0,i.serverUrl=o,t(i).promise.then(function(n){u.Payload=n.value})),u}),{promise:e,cancel:f.cancel}}var i={None:"",Equals:"{0} eq {1}",NotEquals:"{0} ne {1}",Contains:"substringof({1}, {0}) eq true",StartsWith:"startswith({0}, {1}) eq true",EndsWith:"endswith({0}, {1}) eq true",NotContains:"substringof({1}, {0}) eq false",NotStartsWith:"startswith({0}, {1}) eq false",NotEndsWith:"endswith({0}, {1}) eq false",Gte:"{0} ge {1}",Gt:"{0} gt {1}",Lte:"{0} le {1}",Lt:"{0} lt {1}"};return{get:n.get,getByKey:r,retrieveDataAsync:t}}])})(angular),function(n){"use strict";n.module("tubular.services").run(["tubularHttp","tubularOData",function(n,t){n.registerService("odata",t)}])}(angular);