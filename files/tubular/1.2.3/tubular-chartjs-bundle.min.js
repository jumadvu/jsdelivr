/*!
 * angular-chart.js - An angular.js wrapper for Chart.js
 * http://jtblin.github.io/angular-chart.js/
 * Version: 1.1.1
 *
 * Copyright 2016 Jerome Touffe-Blin
 * Released under the BSD-2-Clause license
 * https://github.com/jtblin/angular-chart.js/blob/master/LICENSE
 */
(function(n){"use strict";if(typeof exports=="object")module.exports=n(typeof angular!="undefined"?angular:require("angular"),typeof Chart!="undefined"?Chart:require("chart.js"));else if(typeof define=="function"&&define.amd)define(["angular","chart"],n);else{if(typeof angular=="undefined")throw new Error("AngularJS framework needs to be included, see https://angularjs.org/");else if(typeof Chart=="undefined")throw new Error("Chart.js library needs to be included, see http://jtblin.github.io/angular-chart.js/");n(angular,Chart)}})(function(n,t){"use strict";function r(){var i={responsive:!0},r={Chart:t,getOptions:function(t){var r=t&&i[t]||{};return n.extend({},i,r)}};this.setOptions=function(t,u){u?i[t]=n.merge(i[t]||{},u):(u=t,i=n.merge(i,u));n.merge(r.Chart.defaults,i)};this.$get=function(){return r}}function u(r,u){function e(n,t,i){var f=rt(n,t),u,e,o;d(t)&&et(n,t,i,f)&&(u=i[0],e=u.getContext("2d"),t.chartGetColor=g(t),o=nt(n,t),h(t),t.chart=new r.Chart(e,{type:n,data:o,options:f}),t.$emit("chart-create",t.chart),ut(u,t))}function v(n,t){return n&&t&&n.length&&t.length?Array.isArray(n[0])?n.length===t.length&&n.every(function(n,i){return n.length===t[i].length}):t.reduce(y,0)>0?n.length===t.length:!1:!1}function y(n,t){return n+t}function c(t,i,r){var u={point:void 0,points:void 0};return function(f){var s=t.chart.getElementAtEvent||t.chart.getPointAtEvent,h=t.chart.getElementsAtEvent||t.chart.getPointsAtEvent,e,o;h&&(e=h.call(t.chart,f),o=s?s.call(t.chart,f)[0]:void 0,r!==!1&&(n.equals(u.points,e)||n.equals(u.point,o))||(u.point=o,u.points=e,t[i](e,f,o)))}}function p(i,u){for(var f=n.copy(u.chartColors||r.getOptions(i).chartColors||t.defaults.global.colors),e=f.length<u.chartData.length;f.length<u.chartData.length;)f.push(u.chartGetColor());return e&&(u.chartColors=f),f.map(w)}function w(n){return typeof n=="string"&&n[0]==="r"?o(k(n)):typeof n=="string"&&n[0]==="#"?o(b(n.substr(1))):typeof n=="object"&&n!==null?n:l()}function l(){var n=[s(0,255),s(0,255),s(0,255)];return o(n)}function o(n){var t=n[3]||1;return n=n.slice(0,3),{backgroundColor:f(n,.2),pointBackgroundColor:f(n,t),pointHoverBackgroundColor:f(n,.8),borderColor:f(n,t),pointBorderColor:"#fff",pointHoverBorderColor:f(n,t)}}function s(n,t){return Math.floor(Math.random()*(t-n+1))+n}function f(n,t){return i?"rgb("+n.join(",")+")":"rgba("+n.concat(t).join(",")+")"}function b(n){var t=parseInt(n,16),i=t>>16&255,r=t>>8&255,u=t&255;return[i,r,u]}function k(n){var t=n.match(/^rgba?\(([\d,.]+)\)$/);if(!t)throw new Error("Cannot parse rgb value");return n=t[1].split(","),n.map(Number)}function d(n){return n.chartData&&n.chartData.length}function g(n){return typeof n.chartGetColor=="function"?n.chartGetColor:l}function nt(n,t){var i=p(n,t);return Array.isArray(t.chartData[0])?tt(t.chartLabels,t.chartData,t.chartSeries||[],i,t.chartDatasetOverride):it(t.chartLabels,t.chartData,i,t.chartDatasetOverride)}function tt(t,i,r,u,f){return{labels:t,datasets:i.map(function(t,i){var e=n.extend({},u[i],{label:r[i],data:t});return f&&f.length>=i&&n.merge(e,f[i]),e})}}function it(t,i,r,u){var f={labels:t,datasets:[{data:i,backgroundColor:r.map(function(n){return n.pointBackgroundColor}),hoverBackgroundColor:r.map(function(n){return n.backgroundColor})}]};return u&&n.merge(f.datasets[0],u),f}function rt(t,i){return n.extend({},r.getOptions(t),i.chartOptions)}function ut(t,i){t.onclick=i.chartClick?c(i,"chartClick",!1):n.noop;t.onmousemove=i.chartHover?c(i,"chartHover",!0):n.noop}function ft(n,t){Array.isArray(t.chartData[0])?t.chart.data.datasets.forEach(function(t,i){t.data=n[i]}):t.chart.data.datasets[0].data=n;t.chart.update();t.$emit("chart-update",t.chart)}function a(n){return!n||Array.isArray(n)&&!n.length||typeof n=="object"&&!Object.keys(n).length}function et(n,t,i,r){return r.responsive&&i[0].clientHeight===0?(u(function(){e(n,t,i)},50,!1),!1):!0}function h(n){n.chart&&(n.chart.destroy(),n.$emit("chart-destroy",n.chart))}return function(t){return{restrict:"CA",scope:{chartGetColor:"=?",chartType:"=",chartData:"=?",chartLabels:"=?",chartOptions:"=?",chartSeries:"=?",chartColors:"=?",chartClick:"=?",chartHover:"=?",chartDatasetOverride:"=?"},link:function(r,u){function o(n,i){if(!n||!n.length||Array.isArray(n[0])&&!n[0].length){h(r);return}var f=t||r.chartType;if(f){if(r.chart&&v(n,i))return ft(n,r);e(f,r,u)}}function f(i,f){if(!a(i)&&!n.equals(i,f)){var o=t||r.chartType;o&&e(o,r,u)}}function s(t,i){a(t)||n.equals(t,i)||e(t,r,u)}i&&window.G_vmlCanvasManager.initElement(u[0]);r.$watch("chartData",o,!0);r.$watch("chartSeries",f,!0);r.$watch("chartLabels",f,!0);r.$watch("chartOptions",f,!0);r.$watch("chartColors",f,!0);r.$watch("chartDatasetOverride",f,!0);r.$watch("chartType",s,!1);r.$on("$destroy",function(){h(r)});r.$on("$resize",function(){r.chart&&r.chart.resize()})}}}}t.defaults.global.multiTooltipTemplate="<%if (datasetLabel){%><%=datasetLabel%>: <%}%><%= value %>";t.defaults.global.tooltips.mode="label";t.defaults.global.elements.line.borderWidth=2;t.defaults.global.elements.rectangle.borderWidth=2;t.defaults.global.legend.display=!1;t.defaults.global.colors=["#97BBCD","#DCDCDC","#F7464A","#46BFBD","#FDB45C","#949FB1","#4D5360"];var i=typeof G_vmlCanvasManager=="object"&&window.G_vmlCanvasManager!==null&&typeof window.G_vmlCanvasManager.initElement=="function";return i&&(t.defaults.global.animation=!1),n.module("chart.js",[]).provider("ChartJs",r).factory("ChartJsFactory",["ChartJs","$timeout",u]).directive("chartBase",["ChartJsFactory",function(n){return new n}]).directive("chartLine",["ChartJsFactory",function(n){return new n("line")}]).directive("chartBar",["ChartJsFactory",function(n){return new n("bar")}]).directive("chartHorizontalBar",["ChartJsFactory",function(n){return new n("horizontalBar")}]).directive("chartRadar",["ChartJsFactory",function(n){return new n("radar")}]).directive("chartDoughnut",["ChartJsFactory",function(n){return new n("doughnut")}]).directive("chartPie",["ChartJsFactory",function(n){return new n("pie")}]).directive("chartPolarArea",["ChartJsFactory",function(n){return new n("polarArea")}]).directive("chartBubble",["ChartJsFactory",function(n){return new n("bubble")}]).name}),function(n){"use strict";n.module("tubular-chart.directives",["tubular.services","chart.js"]).component("tbChartjs",{template:'<div class="tubular-chart"><canvas class="chart chart-base" chart-type="$ctrl.chartType" chart-data="$ctrl.data" chart-labels="$ctrl.labels"  chart-series="$ctrl.series" chart-click="$ctrl.onClick" chart-options="$ctrl.options"><\/canvas><ul ng-show="$ctrl.showLegend" class="pie-legend"><li ng-repeat="item in $ctrl.legends"><span style="background-color: {{item.color}}"><\/span>{{item.label}}<\/li><\/ul><div class="alert alert-info" ng-show="$ctrl.isEmpty">{{$ctrl.emptyMessage}}<\/div><div class="alert alert-warning" ng-show="$ctrl.hasError">{{$ctrl.errorMessage}}<\/div><\/div>',bindings:{serverUrl:"@",requireAuthentication:"=?",showLegend:"@?",name:"@?chartName",chartType:"@?",emptyMessage:"@?",errorMessage:"@?",onLoad:"=?",onClick:"=?",data:"=?",labels:"=?",series:"=?",options:"=?"},controller:["$scope","tubularHttp",function(t,i){var r=this;r.dataService=i.getDataService(r.dataServiceName);r.showLegend=n.isUndefined(r.showLegend)?!0:r.showLegend;r.chartType=r.chartType||"line";r.requireAuthentication=n.isUndefined(r.requireAuthentication)?!0:r.requireAuthentication;r.loadData=function(){i.setRequireAuthentication(r.requireAuthentication);i.get(r.serverUrl).promise.then(function(n){if(!n||!n.Data||n.Data.length===0){if(r.isEmpty=!0,r.options||(r.options={}),r.options.series=[{data:[]}],r.onLoad)r.onLoad(r.options,{});return}if(r.isEmpty=!1,r.data=n.Data,r.series=n.Series,r.labels=n.Labels,r.onLoad)r.onLoad(r.options,n)},function(n){t.$emit("tbChart_OnConnectionError",n)})};t.$watch("$ctrl.serverUrl",function(t){n.isDefined(t)&&t!=null&&r.loadData()});t.$on("chart-create",function(n,t){r.legends=r.chartType==="pie"||r.chartType==="doughnut"?t.chart.config.data.labels.map(function(n,i){return{label:n,color:t.chart.config.data.datasets[0].backgroundColor[i]}}):t.chart.config.data.datasets.map(function(n){return{label:n.label,color:n.borderColor}})})}]})}(angular);