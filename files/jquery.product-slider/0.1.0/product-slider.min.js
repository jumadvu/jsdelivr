$.fn.cssTransition=function(t){return this.css({"-webkit-transition":t,"-moz-transition":t,"-ms-transition":t,"-o-transition":t,transition:t})},$.widget("nmk.productSlider",{options:{previewHeight:450,slideWidth:300,navbarHeight:150,animationTime:400,autoplay:3e3,stopOnMouseHover:!0,delayOnClick:2e3},props:{selected:void 0,sliderContainer:void 0,sliderBackground:void 0,sliderBar:void 0,products:void 0,timerDelaied:!1,carouselTimer:void 0},_create:function(){this._update(),this.props.sliderContainer.on("mouseenter",()=>{this.options.stopOnMouseHover&&this._stopCarousel()}),this.props.sliderContainer.on("mouseleave",()=>{(this.options.stopOnMouseHover||void 0===this.props.carouselTimer)&&this._startCarousel()})},_startCarousel:function(t=0){this.props.autoplay<=0||(void 0!==this.props.carouselTimer&&this._stopCarousel(),this.props.carouselTimer=setTimeout(()=>{const t=(this.props.selected+1)%this.props.products.length;this._deactivateNavElement(this.props.selected),this._activateNavElement(t),this._startCarousel()},this.options.autoplay+t))},_stopCarousel:function(){this.props.carouselTimer=clearTimeout(this.props.carouselTimer)},_setOption:function(t,i){this.options[t]=i,this._update()},_update:function(){this._collectProducts(),this._createSliderContainer(),this._createSliderBar(),this.element.after(this.props.sliderContainer,this.props.sliderBar),this.props.sliderBar.on("click","a",t=>{const i=t.currentTarget;this._handleNavClick(t,i)}),this._activateNavElement(0),this._trigger("onInitialized",null,Object.assign({},this.props.products)),this._startCarousel()},_get_selected_product:function(){if(void 0!==this.props.selected)return this.props.products[this.props.selected]},_handleNavClick:function(t,i){t.preventDefault();const s=$(i).attr("id").split("-").pop();this._deactivateNavElement(this.props.selected),this._activateNavElement(s,t),this._startCarousel(this.options.delayOnClick)},_deactivateNavElement:function(t){this.props.sliderBar.find(`#slide-link-${t}`).removeClass("active"),this.props.sliderContainer.find(`#slide-${t}`).hide().removeClass("active"),this.props.sliderContainer.find(`#slide-description-${t}`).fadeOut(this.options.animationTime)},_activateNavElement:function(t,i=null){const s=this._get_selected_product(),e=void 0===s?0:this.options.animationTime;this.props.sliderBar.find(`#slide-link-${t}`).addClass("active"),this.props.sliderContainer.find(`#slide-${t}`).fadeIn(e).addClass("active"),this.props.sliderContainer.find(`#slide-description-${t}`).fadeIn(e),this.props.sliderContainer.find(".slider-background").css("background-image",`url("${this.props.products[t].url}")`),this.props.selected=t,this._trigger("onNavChanged",i,{before:s,current:this._get_selected_product()})},_createDiv:function(t){return $(document.createElement("div")).addClass(t)},_collectProducts:function(){this.props.products=[],this.element.find("> div").each((t,i)=>{let s=$(i).find(".content").first();const e=$(i).find("img").first(),r=$(i).find("span").first();0===s.length&&(s=e);const o=e.attr("src");let n=void 0;if(0!==r.length)n=r.html();else if("A"===s.prop("tagName")){const t=s.attr("href"),i=e.attr("src").replace(/(.*)\/(.*)\.(.*?)$/,"$2");n=`<a href="${t}">${i}</a>`}else n=e.attr("src").replace(/(.*)\/(.*)\.(.*?)$/,"$2");this.props.products.push({id:t,url:o,content:s,description:n})})},_createSliderContainer:function(){this.props.sliderContainer=this._createDiv("slider-container").css("height",this.options.previewHeight);const t=(this.options.animationTime/1e3).toFixed(2);this.props.sliderBackground=this._createDiv("slider-background").cssTransition(`background-image ${t}s ease-out`);const i=this._createDiv("slider").css("width",this.options.slideWidth);this.props.products.forEach((t,s)=>{const e=this._createDiv("slide").attr("id",`slide-${s}`),r=$(document.createElement("span")).attr("id",`slide-description-${s}`).addClass("description").html(t.description);e.append(t.content,r),i.append(e)}),this.props.sliderContainer.append(this.props.sliderBackground),this.props.sliderContainer.append(i)},_createSliderBar:function(){this.props.sliderBar=this._createDiv("slider-bar row").css("height",this.options.navbarHeight);const t=(this.options.animationTime/1e3).toFixed(2),i=Math.floor(12/this.props.products.length);this.props.products.forEach((s,e)=>{const r=this._createDiv(`slide-info col-${i}`).attr("id",e),o=$(document.createElement("a")).attr("href","#").attr("id",`slide-link-${e}`).cssTransition(`opacity ${t}s ease-out`).addClass("slide-link"),n=$(document.createElement("img")).attr("src",s.url);o.append(n),r.append(o),this.props.sliderBar.append(r)})}});
