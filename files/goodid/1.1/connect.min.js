!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.GoodID=e()}}(function(){var define,module,exports;return function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function i(e){return 3*e.length/4-r(e)}function o(e){var t,n,i,o,s,a,u=e.length;s=r(e),a=new d(3*u/4-s),i=s>0?u-4:u;var c=0;for(t=0,n=0;t<i;t+=4,n+=3)o=l[e.charCodeAt(t)]<<18|l[e.charCodeAt(t+1)]<<12|l[e.charCodeAt(t+2)]<<6|l[e.charCodeAt(t+3)],a[c++]=o>>16&255,a[c++]=o>>8&255,a[c++]=255&o;return 2===s?(o=l[e.charCodeAt(t)]<<2|l[e.charCodeAt(t+1)]>>4,a[c++]=255&o):1===s&&(o=l[e.charCodeAt(t)]<<10|l[e.charCodeAt(t+1)]<<4|l[e.charCodeAt(t+2)]>>2,a[c++]=o>>8&255,a[c++]=255&o),a}function s(e){return c[e>>18&63]+c[e>>12&63]+c[e>>6&63]+c[63&e]}function a(e,t,n){for(var r,i=[],o=t;o<n;o+=3)r=(e[o]<<16)+(e[o+1]<<8)+e[o+2],i.push(s(r));return i.join("")}function u(e){for(var t,n=e.length,r=n%3,i="",o=[],s=16383,u=0,l=n-r;u<l;u+=s)o.push(a(e,u,u+s>l?l:u+s));return 1===r?(t=e[n-1],i+=c[t>>2],i+=c[t<<4&63],i+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],i+=c[t>>10],i+=c[t>>4&63],i+=c[t<<2&63],i+="="),o.push(i),o.join("")}n.byteLength=i,n.toByteArray=o,n.fromByteArray=u;for(var c=[],l=[],d="undefined"!=typeof Uint8Array?Uint8Array:Array,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,p=g.length;f<p;++f)c[f]=g[f],l[g.charCodeAt(f)]=f;l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],2:[function(e,t,n){!function(e){function n(){}function r(e,t){return function(){e.apply(t,arguments)}}function i(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(e,this)}function o(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void i._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null===n)return void(1===e._state?s:a)(t.promise,e._value);var r;try{r=n(e._value)}catch(i){return void a(t.promise,i)}s(t.promise,r)}))}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof i)return e._state=3,e._value=t,void u(e);if("function"==typeof n)return void l(r(n,t),e)}e._state=1,e._value=t,u(e)}catch(o){a(e,o)}}function a(e,t){e._state=2,e._value=t,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)o(e,e._deferreds[t]);e._deferreds=null}function c(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function l(e,t){var n=!1;try{e(function(e){n||(n=!0,s(t,e))},function(e){n||(n=!0,a(t,e))})}catch(r){if(n)return;n=!0,a(t,r)}}var d=setTimeout;i.prototype["catch"]=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var r=new this.constructor(n);return o(this,new c(e,t,r)),r},i.all=function(e){var t=Array.prototype.slice.call(e);return new i(function(e,n){function r(o,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(e){r(o,e)},n)}t[o]=s,0===--i&&e(t)}catch(u){n(u)}}if(0===t.length)return e([]);for(var i=t.length,o=0;o<t.length;o++)r(o,t[o])})},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i(function(t){t(e)})},i.reject=function(e){return new i(function(t,n){n(e)})},i.race=function(e){return new i(function(t,n){for(var r=0,i=e.length;r<i;r++)e[r].then(t,n)})},i._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){d(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},i._setImmediateFn=function(e){i._immediateFn=e},i._setUnhandledRejectionFn=function(e){i._unhandledRejectionFn=e},"undefined"!=typeof t&&t.exports?t.exports=i:e.Promise||(e.Promise=i)}(this)},{}],3:[function(e,t,n){"use strict";var r=e("./eventHandler"),i=e("./language"),o=["implicit","auth_code"],s=[1,2,3],a=["profile","email","address","phone","billto","pcard","mrtd"],u=/Edge\/|Trident\/|MSIE /.test(window.navigator.userAgent),c="RS256",l={requiredParams:["client_id","lang","state","nonce"],exConf:{},cryptoAlg:c,configParams:{flow:o[0],client_id:null,redirect_uri:null,scope:"openid",claims:null,access_token:!1,state:null,nonce:null,display:u?"page":"popup",onlogin:null,acr:1,cryptoShim:"//connect.goodid.net/v1.0/msrcrypto.min.js",generateKey:3,request:null,lang:null,signInBtn:null,from_app:!1},setParams:function(t){var n,u=function(e,t){throw'GoodID :: Invalid "'+e+'" configuration value "'+t+'".'};this.exConf=Object.assign(this.exConf,t);for(var c in t){switch(n=t[c],"string"==typeof n&&(n=n.trim()),c){case"flow":o.indexOf(n)===-1&&(u(c,n),n=o[0]);break;case"scope":var l=[],d=n.split(" ");for(var g in d)a.indexOf(d[g])>-1?l.push(d[g]):d[g]&&u(c,d[g]);n="openid"+(l.length?" "+l.join(" "):"");break;case"claims":"string"!=typeof n&&(n=JSON.stringify(n));break;case"onlogin":"function"==typeof n&&r.registerEventHandler("authDone",n);break;case"acr":n=s.indexOf(n)>-1?n:1;break;case"generateKey":!!n==!1&&(n=0),n===!0&&(n=3),("number"!=typeof n||n<0||n>3)&&u(c,n);break;case"request":this.checkRequest(n);break;case"lang":"string"==typeof n&&i[n]||u(c,n),this.configParams.signInBtn=i[n].signIn;break;case"from_app":"boolean"!=typeof n&&u(c,n)}this.configParams[c]=n}if(["state","nonce"].forEach(function(e){null===this.get(e)&&this.set(e,this.generateRandom(16))}.bind(this)),this.get("generateKey")<=1&&!this.get("request"))throw"Request object is unset! If you have your own signing key, you will need to provide the request JWS object. Please refer to the docs.";var f=e("./keyHelper");return f.eligibleForKeyGeneration()&&f.generateKeys(),this},get:function(e,t){return"undefined"!=typeof this.configParams[e]&&null!==this.configParams[e]?this.configParams[e]:"undefined"==typeof t?null:t},set:function(e,t){if("object"==typeof e)return this.setParams(e);var n={};return n[e]=t,this.setParams(n)},checkIfRequiredParamsExist:function(){var e=!1;for(var t in this.requiredParams)null===this.get(this.requiredParams[t])&&(window.console&&console.error('Configuration parameter "'+this.requiredParams[t]+'" is required.'),e=!0);if(e)throw"Some mandatory parameters are missing. Please review your GoodID configuration."},checkRequest:function(t){var n=e("./jose");try{var r=n.processJws(t)}catch(i){throw"There is something wrong with the request object: "+i}["client_id","state","nonce"].forEach(function(e){if(!r.payload.hasOwnProperty(e))throw"Parameter `"+e+"` is missing from the request object!"})},generateRandom:function(e){return Math.round(Math.pow(36,e+1)-Math.random()*Math.pow(36,e)).toString(36).slice(1)}};t.exports=l},{"./eventHandler":7,"./jose":8,"./keyHelper":9,"./language":10}],4:[function(e,t,n){"use strict";t.exports={GENKEY_NONE:0,GENKEY_ENC:1,GENKEY_SIG:2,GENKEY_ALL:3}},{}],5:[function(e,t,n){"use strict";function r(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}var i,o=e("./config"),s=e("./stringHelper"),a=e("./windowHandler"),u={sign:["sign","verify"],derive:["deriveKey","deriveBits"],enc:["encrypt","decrypt"]},c={sign:{R:["RSASSA-PKCS1-v1_5","sign"],P:["RSA-PSS","sign"],E:["ECDSA","sign"],H:["HMAC","sign"]},enc:{R:["RSA-OAEP","enc"],E:["ECDH","derive"]}},l="P-256",d={modulusLength:1024,publicExponent:new Uint8Array([1,0,1])},g=128,f=function(){return new Promise(function(e,t){function n(e){t(e),a.closeWindow(e)}if(i)return e();var s=window.crypto&&window.crypto.subtle;if("http:"!==location.protocol&&s)s?(i=s,e()):n("Your browser doesn't support crypto operations.");else{var u=document.createElement("script");u.src=o.get("cryptoShim"),u.onload=function(){if(window.msrCrypto){msrCrypto.subtle.forceSync=!0;for(var t=[],o=0;o<48;o++)t.push(r(0,256));msrCrypto.initPrng(t),i=msrCrypto.subtle}else s&&(i=s);i?e():n("Could not load crypto JS lib properly. Make sure it implements the window.crypto.subtle interface.")},u.onerror=n.bind(null,"Uh oh... could not load crypto JS library!\n\nThis usually means that there's someone currently fidgeting with the site.\nPlease try again shortly.");var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(u,c)}})},p=function(e,t,n){if(!(n in c))throw"Invalid operation `"+n+"` for the `"+e+"` action";if("none"===t)throw"Can't accept none as alg";var r=t[0],i=t.substr(2);if(!(r in c[n])||["256","384","512"].indexOf(i)===-1)throw'Could not recognize `alg` parameter value "'+t+'"';var o={name:c[n][r][0]};if("gen"===e)switch(r){case"R":case"P":Object.assign(o,d);break;case"E":o.namedCurve=l}return"sig"===e&&"P"===r&&(o.saltLength=g),("gen"===e&&"E"!==r||"sig"===e&&"E"===r)&&(o.hash={name:"SHA-"+i}),{params:o,operations:u[c[n][r][1]]}},h={generateKey:function(e,t){var n=p("gen",e,t);return i.generateKey(n.params,!0,n.operations)},sign:function(e,t){"string"==typeof e&&(e=s.toBuffer(e));var n=p("sig",o.cryptoAlg,"sign");return i.sign(n.params,t,e)},exportKey:function(e,t){return i.exportKey(t||"jwk",e.privateKey||e.publicKey||e)},importKey:function(e,t,n,r){var o="alg"in e?"jwk":"raw";return i.importKey(o,e,t,!!n,r||["decrypt"])},decrypt:function(e,t,n){return i.decrypt(e,t,n)}},y={init:f};Object.keys(h).forEach(function(e){y[e]=function(){var t=arguments;return f().then(function(){return h[e].apply(null,t)})["catch"](console.error)}}),t.exports=y},{"./config":3,"./stringHelper":14,"./windowHandler":15}],6:[function(e,t,n){"use strict";var r=e("./eventHandler"),i=e("./config"),o=["scope","onlogin"],s=".goodid-login{cursor:pointer;box-sizing:border-box;margin:0;border:0;padding:0;min-width:0;max-width:none;height:34px;font:11px/32px Verdana,Geneva,sans-serif;background-color:#0095da;color:#fff}.goodid-login::-moz-focus-inner{padding:0;border:0}.goodid-login>*{float:left}.goodid-login img{height:22px;width:15px;margin:5px 10px 0}.goodid-login span{position:relative;display:inline-block;padding:0 15px}.goodid-login.small{font-size:10px;height:26px;line-height:24px}.goodid-login.small img{height:15px;width:11px}.goodid-login.large{font-size:12px;height:40px;line-height:38px}.goodid-login.large img{height:28px;width:20px}.goodid-login.sep span:before{content:'';display:inline-block;position:absolute;top:-1px;margin-left:-15px;width:1px;height:34px;background:#fff}.goodid-login.sep.small span:before{height:26px}.goodid-login.sep.large span:before{height:40px}.goodid-login.round{border-radius:5px}.goodid-login.white{border:1px solid #808285;background-color:#fff;color:#0095da}",a=!1,u=["small","default","large"],c=["sep","sep round","round","white","white round"],l={renderButtons:function(){this.processButtons(document.getElementsByTagName("goodid:login")),this.processButtons(document.getElementsByClassName("goodid-login-button"))},processButtons:function(e){var t,n,r,i;if(0!==e.length){for(this.addStyle(e[0]),i=e.length-1;i>=0;i--)t=e[i],n=this.createButtonElement(t),r=t.parentNode,r.insertBefore(n,t),r.removeChild(t);return!0}},addStyle:function(e){if(!a){var t=document.createElement("style");t.type="text/css",t.innerHTML=s,e.parentNode.insertBefore(t,e),a=!0}},createButtonElement:function(e){var t,n,s,a,l=document.createElement("button");for(l.innerHTML='<img alt="GoodID" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2ODUgMTAwMCI+PHBhdGggZD0ibTM0MywxMDAwYy0xODksMCAtMzQzLC0xNTQgLTM0MywtMzQ0bDAsLTI3NWMwLC00OSAzNywtODYgODUsLTg2YzE1LDAgMjgsMyA0MCwxMGwwLC0xNDVjMCwtNDcgNDEsLTg2IDg5LC04NmMxNiwwIDMxLDQgNDQsMTJjMCwtNDggMzcsLTg2IDg0LC04NmwxLDBjMzYsMCA2NiwyMiA3OCw1M2MxNSwtMTAgMzIsLTE2IDUxLC0xNmM0OCwwIDg4LDM5IDg4LDg2bDAsMzAyYzI5LC0yOSA2NywtNDYgMTAzLC00NmMxMywwIDIyLDkgMjIsMjJsMCwyNTVjMCwxOTAgLTE1MywzNDQgLTM0MiwzNDR6bTEwMCwtMzEwYzAsLTU1IC00NSwtMTAwIC0xMDAsLTEwMGMtNTUsMCAtOTksNDUgLTk5LDEwMGMwLDM0IDE0LDY0IDQzLDgybDAsNzFjMCwxMiAxMSwyMCAyMywyMGw2NiwwYzEyLDAgMjIsLTggMjIsLTIwbDAsLTcwYzI5LC0xOCA0NSwtNDkgNDUsLTgzem0tMzU4LC0zNTFsMCwwYy0yMywwIC00MSwxOCAtNDEsNDJsMCwyNzVjMCwxNjUgMTM0LDMwMCAyOTksMzAwYzE2NCwwIDI5OCwtMTM1IDI5OCwtMzAwbDAsLTIzMGMtNDEsMTIgLTgxLDU0IC04MSwxMDRsMCw2OGMwLDEyIC0xMCwyMiAtMjIsMjJjLTEyLDAgLTIyLC0xMCAtMjIsLTIybDAsLTQ3NWMwLC0yMiAtMjEsLTQyIC00NCwtNDJjLTI0LDAgLTQ1LDIwIC00NSw0MmwwLDM3MmMwLDEyIC05LDIyIC0yMiwyMmMtMTIsMCAtMjIsLTEwIC0yMiwtMjJsMCwtNDA5YzAsLTIzIC0xOCwtNDIgLTQwLC00MmMtMjMsMCAtNDEsMTkgLTQxLDQybDAsNDA5YzAsMTIgLTEwLDIyIC0yMiwyMmMtMTIsMCAtMjIsLTEwIC0yMiwtMjJsMCwtMzM1YzAsLTIzIC0yMSwtNDIgLTQ0LC00MmMtMjQsMCAtNDQsMTkgLTQ0LDQybDAsNDA4YzAsMTIgLTEwLDIyIC0yMywyMmMtMTIsMCAtMjIsLTEwIC0yMiwtMjJsMCwtMTg3YzAsLTI0IC0xNywtNDIgLTQwLC00MmwwLDBsMCwweiIgZmlsbD0id2hpdGUiIC8+PC9zdmc+"><span>'+i.get("signInBtn")+"</span>",l.className="goodid-login",l.addEventListener("click",r.clickLoginBtn.bind(r)),l.type="button",t=e.attributes,a=t.length-1;a>=0;a--)n=t[a].name.replace(/^data\-/,""),s=t[a].value,o.indexOf(n)>-1?l.dataset[n]=s:"size"===n&&u.indexOf(s)>-1?l.className+=" "+s:"style"===n&&c.indexOf(s)>-1&&(l.className+=" "+s,s.indexOf("white")>-1&&(l.innerHTML=l.innerHTML.replace("d2hpdGUiIC8+PC9zdmc+","IzAwOTVkYSIgLz48L3N2Zz4=")));return l}};t.exports=l},{"./config":3,"./eventHandler":7}],7:[function(require,module,exports){"use strict";function hasQueryParamValue(e,t){var n=window.location.search;if(n.length<=1)return!1;"?"===n.charAt(0)&&(n=n.substr(1));for(var r=n.split("&"),i=0;i<r.length;i++)if(r[i]===e+"="+t)return!0;return!1}var windowHandler=require("./windowHandler"),previousButtonListener,inited=!1,events={init:"goodid.init",authStart:"goodid.auth.start",authDone:"goodid.auth.done"},eventHandler={loginStatus:null,registerEventHandler:function(e,t){events[e]&&new CustomEvent(events[e]),window.addEventListener(events[e]||e,t)},dispatchEvent:function(e,t){var n=new CustomEvent(events[e],{detail:t||{}});window.dispatchEvent(n)},init:function(e,t){var n;0===location.hash.indexOf("#id_token")&&location.hash.length>100&&(require("./config").setParams(e),n=require("./keyHelper"),n.doKeyExists()&&this.dispatchEvent("authDone")),inited||(hasQueryParamValue("sign-in","goodid")&&(e.from_app=!0,e.display="page"),require("./config").setParams(e),this.registerEventHandler("message",this.receiveMessageFromPopup.bind(this)),n=require("./keyHelper"),n.eligibleForKeyGeneration()&&n.generateKeys(),require("./elementHandler").renderButtons(),inited=!0,this.dispatchEvent("init"),t&&(t.onload=null))},clickLoginBtn:function(e){var config=require("./config"),btn=e.target;btn.dataset.scope&&config.set("scope",btn.dataset.scope),btn.dataset.onlogin&&(previousButtonListener&&window.removeEventListener(events.authDone,previousButtonListener),previousButtonListener=eval(btn.dataset.onlogin),this.registerEventHandler("authDone",previousButtonListener)),windowHandler.signIn(),this.dispatchEvent("authStart")},receiveMessageFromPopup:function(e){var t=e.origin||e.originalEvent.origin;"https://idp.goodid.net"===t&&"login"===e.data.action&&(require("./resultHelper").reset(),this.loginStatus=e.data.status,this.dispatchEvent("authDone",{status:e.data.status}))}};module.exports=eventHandler},{"./config":3,"./elementHandler":6,"./keyHelper":9,"./resultHelper":13,"./windowHandler":15}],8:[function(e,t,n){"use strict";function r(e){var t,n;for(t in c){if(n=c[t],!(t in e))throw t+" parameter does not exist in header";if(!(e[t]in n))throw"Algorithm "+e[t]+" is not available for the "+t+" parameter"}}function i(e,t){if(e="string"==typeof e?e.split("."):e,e.length!==t)throw"The token must consist of "+t+" parts";return e}function o(e){return atob(e.replace(/-/g,"+").replace(/_/g,"/"))}var s=e("./crypto"),a=e("./stringHelper"),u={name:"AES-GCM",getCek:function(e){return e},getDecryptParams:function(e,t,n){return{name:"AES-GCM",iv:e,additionalData:t,tagLength:8*n.length}},getCipherText:function(e){var t=a.b64ToByteArray(e[3]),n=a.b64ToByteArray(e[4]),r=new ArrayBuffer(t.length+n.length);return new Uint8Array(r).set(t),new Uint8Array(r).set(n,t.length),r}},c={alg:{"RSA-OAEP":{name:"RSA-OAEP",hash:{name:"SHA-1"}},"RSA-OAEP-256":{name:"RSA-OAEP",hash:{name:"SHA-256"}}},enc:{"A128CBC-HS256":{name:"AES-CBC",jwkAlgName:"A128CBC",getCek:function(e){return new Uint8Array(e.slice(16))},getDecryptParams:function(e){return{name:"AES-CBC",iv:e}},getCipherText:function(e){return a.b64ToByteArray(e[3])}},A128GCM:u,A256GCM:u}},l={generateJws:function(e,t,n,r){var i=a.toB64(e)+"."+a.toB64(t);"function"==typeof n?n(i):n&&r&&s.sign(i,n).then(function(e){r(i+"."+a.bufferToB64(e))})},processJws:function(e){var t;e=i(e,3);try{t={header:JSON.parse(o(e[0])),payload:JSON.parse(o(e[1])),signature:e[2]}}catch(n){throw"One or more parts of the token seems to be invalid"}return t},decryptJwe:function(e,t){t=t||function(){},e=i(e,5);var n=JSON.parse(o(e[0]));r(n);var u=c.alg[n.alg],l=c.enc[n.enc],d=JSON.parse(localStorage.getItem("enc-priv-key"));return null===d?t("ID Token can't be decrypted, because the encryption private key doesn't exist."):void s.importKey(d,u).then(function(t){return s.decrypt({name:u.name},t,a.b64ToByteArray(e[1]))}).then(function(e){var t={kty:"oct",k:a.bufferToB64(l.getCek(e)),alg:l.jwkAlgName||n.enc,ext:!0};return s.importKey(t,{name:l.name})}).then(function(t){var n=a.b64ToByteArray(e[2]),r=a.toBuffer(e[0]),i=a.b64ToByteArray(e[4]),o=l.getDecryptParams(n,r,i),u=l.getCipherText(e);return s.decrypt(o,t,u)}).then(function(e){var n=a.fromBuffer(e);t(null,n)})["catch"](t)}};t.exports=l},{"./crypto":5,"./stringHelper":14}],9:[function(e,t,n){"use strict";var r,i=e("./config"),o=e("./crypto"),s=e("./windowHandler"),a=e("./jose"),u=e("./xhr"),c={},l=i.get("generateKey"),d=l>=2,g=2!==l,f=!1,p=function(){return"page"===i.get("display")&&l&&!e("./resultHelper").isLoginSuccessful()},h={generateKeys:function(){return!f&&(f=!0,c={},o.init().then(o.generateKey.bind(null,i.cryptoAlg,"sign")).then(this.handleSignedRequest.bind(this)).then(o.exportKey).then(this.storeKeys.bind(this)).then(function(){i.get("from_app")&&s.signIn()}),!0)},handleSignedRequest:function(e){var t=s.generateRequest(!0);if(r=t.gid_kid,d){var n={typ:"JOSE+JSON",alg:i.cryptoAlg};a.generateJws(n,t,e.privateKey,this.submitPostData.bind(this,"request"))}else this.submitPostData("request",i.get("request"));return e},storeKeys:function(e){var t={},n=Promise.resolve(),r=Promise.resolve();if(["alg","kty","e","n","ext"].forEach(function(n){t[n]=e[n]}),d){var i=Object.assign(Object.assign({},t),{key_ops:["verify"]});n=this.submitPostData("sigPubKey",i)}if(g){var o=Object.assign(Object.assign({},t),{alg:"RSA-OAEP",key_ops:["encrypt"]}),s=Object.assign(Object.assign({},e),{alg:"RSA-OAEP",key_ops:["decrypt"]});r=this.submitPostData("encPubKey",o),localStorage.setItem("enc-priv-key",JSON.stringify(s))}return Promise.all([n,r])},submitPostData:function(e,t){c[e]=t;var n=Object.keys(c).length;return d&&g&&3===n||l<3&&2===n?(c.kid=r,this.pushKeys()):Promise.resolve()},reSubmitPostData:function(){var e=Object.keys(c).length;localStorage.getItem("enc-priv-key")&&(d&&g&&4===e||l<3&&3===e)?this.pushKeys():(f=!1,this.generateKeys())},pushKeys:function(){return new Promise(function(e,t){u.post("https://goodid.net:8172/v1/keystore",{data:c}).success(function(){e()}).error(function(){s.closeWindow("There is something wrong with your authentication. Please try again later."),t()})})},doKeyExists:function(){var e=localStorage.getItem("enc-priv-key");return e&&e.length>100}};t.exports={generateKeys:h.generateKeys.bind(h),eligibleForKeyGeneration:p,reSubmitPostData:h.reSubmitPostData.bind(h),doKeyExists:h.doKeyExists.bind(h)}},{"./config":3,"./crypto":5,"./jose":8,"./resultHelper":13,"./windowHandler":15,"./xhr":16}],10:[function(e,t,n){var r={hu_HU:{signIn:"Bejelentkezés GoodID-val"},en_US:{signIn:"Sign in with GoodID"},en_GB:{signIn:"Sign in with GoodID"}};t.exports=r},{}],11:[function(e,t,n){"use strict";e("./polyfill");var r=e("./config"),i=e("./eventHandler"),o=e("./windowHandler"),s=e("./resultHelper"),a={init:i.init.bind(i),set:r.set.bind(r),getLoginStatus:s.getLoginStatus.bind(s),isLoginSuccessful:s.isLoginSuccessful.bind(s),signIn:o.signIn.bind(o),getParameters:s.parseUrl.bind(s,"hash"),getAccessToken:s.getAccessToken.bind(s),getIdToken:s.getIdToken.bind(s),getUserinfo:s.getUserinfo.bind(s),getData:s.getData.bind(s),getError:s.getError.bind(s)};t.exports=Object.assign(a,e("./const"))},{"./config":3,"./const":4,"./eventHandler":7,"./polyfill":12,"./resultHelper":13,"./windowHandler":15}],12:[function(e,t,n){"use strict";function r(){Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}}function i(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}Object.assign||r(),"function"!=typeof window.CustomEvent&&i(),window.Promise||(window.Promise=e("promise-polyfill")),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(e,t){return new Uint8Array(this.buffer.slice(e,t))})},{"promise-polyfill":2}],13:[function(e,t,n){"use strict";var r,i,o=e("./jose"),s=e("./eventHandler"),a=function(){i={parsedUrl:{},idTokenJws:null,userinfoJws:null}},u=function(){return r||(r=e("./config").get("generateKey")),1===r||3===r};a();var c={reset:a,getLoginStatus:function(){return s.loginStatus?s.loginStatus:this.idTokenExists()?"success":this.getError()?"denied":"nologin"},isLoginSuccessful:function(){return"success"===this.getLoginStatus()},getAccessToken:function(){var e=this.parseUrl("hash");return"access_token"in e?e.access_token:null},idTokenExists:function(){var e=this.parseUrl("hash");return"id_token"in e&&e.id_token.length>0},getData:function(e){var t=this;this.getIdToken(function(n,r){n?e(n):t.getState(function(n,i){n?e(n):t.getAccessToken()?t.getUserinfo(function(t,n){t?e(t):e(null,r,i,n)}):e(null,r,i)})})},getIdToken:function(e){if(u()){if(i.idTokenJws)return e(null,i.idTokenJws);var t=this.parseUrl("hash");if(t.id_token){var n=t.id_token.split(".");if(3===n.length)i.idTokenJws=t.id_token,e(null,t.id_token);else{if(5!==n.length)throw new Error("The ID token is invalid");try{o.decryptJwe(t.id_token,function(t,n){t?e(t):(i.idTokenJws=n,e(null,n))})}catch(r){e(r)}}}}},getUserinfo:function(t){var n=this.getAccessToken();if(!n)return t(null,"");if(i.userinfoJws)return t(null,i.userinfoJws);var r=e("./xhr"),s=e("./windowHandler");r.get(s.getServerUrl("oidc/userinfo"),{headers:{Authorization:"Bearer "+n}}).success(function(e){return e?u()?void o.decryptJwe(e,function(e,n){return e?t(e):(i.userinfoJws=n,void t(null,n))}):(i.userinfoJws=e,t(null,e)):t(null,"")}).error(t.bind(null,new Error("There was an error while fetching the userinfo endpoint.")))},getState:function(e){var t=this.parseUrl("hash");t.state?e(null,t.state):e("Missing state.")},getError:function(){var e=this.parseUrl("hash");return e.error?{error:e.error,description:e.error_description?decodeURI(e.error_description).replace(/\+/g," "):""}:null},parseUrl:function(e){if(e in i.parsedUrl)return i.parsedUrl[e];var t={};if(window.location[e]){var n=window.location[e].substring(1),r=n.split("&");for(var o in r){var s=r[o].split("=");t[s[0]]=s[1]}}return i.parsedUrl[e]=t,t}};t.exports=c},{"./config":3,"./eventHandler":7,"./jose":8,"./windowHandler":15,"./xhr":16}],14:[function(e,t,n){"use strict";var r=e("base64-js"),i=function(e){for(var t,n,t=0,n=4-e.length%4;t<n;t++)e+="=";return e},o=function(e){return e.replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")},s={toB64:function(e){return"string"!=typeof e&&(e=JSON.stringify(e)),o(btoa(e))},b64ToByteArray:function(e){for(var t=r.toByteArray(i(e));0===t[t.length-1];)t=t.slice(0,-1);return t},bufferToB64:function(e){return o(r.fromByteArray(new Uint8Array(e)))},toBuffer:function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0,i=e.length;r<i;r++)n[r]=e.charCodeAt(r);return t},fromBuffer:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}};t.exports=s},{"base64-js":1}],15:[function(e,t,n){"use strict";var r,i,o,s={signIn:function(){if(i=e("./config"),i.checkIfRequiredParamsExist(),"popup"===i.get("display")){var t=screen.availWidth,n=screen.availHeight,r=screen.width,s=screen.height,a=800,u=Math.min(600,n),c=Number(r/2-a/2),l=Number(s/2-u/2),d=r-t,g=s-n,f="width="+a+",height="+u+",";if(c>=d&&(f+="left="+c+","),l>=g&&(f+="top="+l+","),f+="resizable=0,scrollbars=0,status=0",this.closeWindow(),o=window.open(this.getEndpoint(),"goodid-popup",f),o.focus(),i.get("generateKey")){var p=e("./keyHelper");p.generateKeys()||p.reSubmitPostData()}}else window.location.assign(this.getEndpoint());return!1},getEndpoint:function(){return this.getServerUrl("oidc/authorize",this.generateRequest())},generateRequest:function(t){i=i||e("./config");var n={response_type:this.getResponseType(),client_id:i.get("client_id"),redirect_uri:i.get("redirect_uri",this.getCurrentUrl()),scope:i.get("scope"),state:i.get("state"),nonce:i.get("nonce"),display:i.get("display"),ui_locales:this.getBrowserLocales().join(" "),from_app:i.get("from_app")?"1":"0"};return i.get("claims")&&(n.claims=i.get("claims"),t&&(n.claims=JSON.parse(n.claims))),i.exConf.hasOwnProperty("acr")&&(n.claims=this.fillAcrValue(n,i.get("acr"))),i.get("generateKey")&&(r=r||i.generateRandom(16),n.gid_kid=r),n},getBrowserLocales:function(){return navigator.languages?navigator.languages:navigator.userLanguage?[navigator.userLanguage]:navigator.language?[navigator.language]:[]},getResponseType:function(){return"auth_code"===i.get("flow")?"code":"id_token"+(i.get("access_token")?" token":"")},fillAcrValue:function(e,t){var n,r={essential:!0,value:t};return e.claims?(n=JSON.parse(e.claims),n.id_token?n.id_token.acr=r:n.id_token={acr:r}):n={id_token:{acr:r}},JSON.stringify(n)},getCurrentUrl:function(){return window.location.origin+window.location.pathname},getServerUrl:function(e,t){return"https://idp.goodid.net".replace(/\/$/,"")+(e?"/"+e.replace(/^\//,""):"")+(t?this.createQueryString(t):"")},createQueryString:function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.length?"?"+t.join("&"):""},closeWindow:function(e){if(o&&!o.closed)o.close(),o=null;else try{window.stop()}catch(t){document.execCommand("Stop")}e&&alert(e)}};t.exports=s},{"./config":3,"./keyHelper":9}],16:[function(e,t,n){"use strict";var r={contentType:"application/json"},i=function(e){var t;try{t=JSON.parse(e.responseText)}catch(n){t=e.responseText}return[t,e]},o=function(e){if(!(!1 in e))switch(r.contentType){case"application/json":return JSON.stringify(e.data)}},s=function(e,t,n){n=n||{};var s={success:function(){},error:function(){},always:function(){}},a=window.XMLHttpRequest||ActiveXObject,u=new a("MSXML2.XMLHTTP.3.0");if(u.open(e,t,!0),u.setRequestHeader("Content-type",r.contentType),n.headers)for(var c in n.headers)u.setRequestHeader(c,n.headers[c]);u.onreadystatechange=function(){var e;4===u.readyState&&(e=i(u),u.status>=200&&u.status<300?s.success.apply(s,e):s.error.apply(s,e),s.always.apply(s,e))},u.send(o(n));var l={success:function(e){return s.success=e,l},error:function(e){return s.error=e,l},always:function(e){return s.always=e,l}};return l};t.exports={get:function(e,t){return s("GET",e,t)},post:function(e,t){return s("POST",e,t)},put:function(e,t){return s("PUT",e,t)},"delete":function(e,t){return s("DELETE",e,t)},setContentType:function(e){return r.contentType=e,this}}},{}]},{},[11])(11)});